name: Releases

on:
  push:
    tags:
      - v*
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@master
    - name: Get version from tag
      id: tag_name
      run: |
        echo "current_version=${GITHUB_REF#refs/tags/v}" >> $GITHUB_OUTPUT
    - name: Archive Release
      uses: thedoctor0/zip-release@main
      with:
        type: 'zip'
        filename: 'agentic.zip'
        path: 'agentic'
    - name: Get Changelog Entry
      id: changelog_reader
      uses: mindsers/changelog-reader-action@v2
      with:
        validation_level: warn
        version: ${{ steps.tag_name.outputs.current_version }}
        path: ./CHANGELOG.md
    - name: Create a Release
      uses: softprops/action-gh-release@v2
      with:
        name: ${{ steps.changelog_reader.outputs.date }}
        body: ${{ steps.changelog_reader.outputs.changes }}
        files: "agentic.zip"
        make_latest: true
        tag_name: ${{ steps.tag_name.outputs.current_version }}

